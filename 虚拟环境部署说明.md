# 2D数字人项目 - Python虚拟环境部署说明

## 📋 部署概述

本文档记录了2D数字人项目Python虚拟环境的创建和配置过程，包括遇到的问题和解决方案。

## ✅ 已完成的配置

### 1. 虚拟环境创建
```bash
# 创建虚拟环境
python -m venv venv

# 激活虚拟环境 (Windows)
venv\Scripts\Activate.ps1
```

### 2. 依赖包安装
```bash
# 升级pip
python -m pip install --upgrade pip

# 安装PyTorch (CPU版本)
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu

# 安装项目依赖
pip install -r requirements.txt

# 额外安装的包
pip install opencv-python==4.8.1.78
```

### 3. 环境验证

✅ **成功安装的组件：**
- Python 3.11.0
- PyTorch 2.8.0+cpu
- OpenCV 4.8.1
- Gradio 5.44.1
- NumPy 1.26.4
- 其他依赖包（共80+个）

## ⚠️ 已知问题

### 1. MediaPipe DLL加载失败
**问题描述：**
```
ImportError: DLL load failed while importing _framework_bindings: 动态链接库(DLL)初始化例程失败。
```

**原因分析：**
- MediaPipe需要Microsoft Visual C++ Redistributable
- Windows系统缺少必要的运行时库

**解决方案：**
1. 下载并安装 [Microsoft Visual C++ Redistributable](https://docs.microsoft.com/en-us/cpp/windows/latest-supported-vc-redist)
2. 或者使用conda环境：`conda install mediapipe`
3. 临时方案：跳过MediaPipe相关功能

### 2. Gradio网络启动问题
**问题描述：**
```
Exception: Couldn't start the app because 'http://localhost:7860/gradio_api/startup-events' failed (code 502)
```

**原因分析：**
- 网络代理设置问题
- 防火墙阻止localhost访问
- 端口被占用

**解决方案：**
1. 检查网络代理设置
2. 临时关闭防火墙测试
3. 使用share=True创建公共链接
4. 尝试不同端口

## 📁 项目文件结构

```
2dHuman/
├── venv/                    # Python虚拟环境
├── models/                  # 模型文件目录（需要创建）
├── audio/                   # 音频文件目录
├── requirements.txt         # 项目依赖
├── app.py                  # 原始应用（MediaPipe问题）
├── app_simple.py           # 简化版应用
├── test_env.py             # 环境测试脚本
├── simple_gradio_test.py   # Gradio测试脚本
└── 虚拟环境部署说明.md      # 本文档
```

## 🚀 启动方式

### 方式1：环境测试
```bash
# 激活虚拟环境
venv\Scripts\Activate.ps1

# 运行环境测试
python test_env.py
```

### 方式2：简化版应用（推荐）
```bash
# 激活虚拟环境
venv\Scripts\Activate.ps1

# 运行简化版应用
python app_simple.py
```

### 方式3：完整应用（需解决MediaPipe问题）
```bash
# 激活虚拟环境
venv\Scripts\Activate.ps1

# 运行完整应用
python app.py
```

## 🔧 故障排除

### 检查虚拟环境状态
```bash
# 检查Python路径
where python

# 检查已安装包
pip list

# 检查虚拟环境激活状态
echo $env:VIRTUAL_ENV  # PowerShell
```

### 重新安装问题包
```bash
# 重新安装MediaPipe
pip uninstall mediapipe -y
pip install mediapipe

# 重新安装Gradio
pip uninstall gradio -y
pip install gradio
```

## 📝 后续优化建议

1. **解决MediaPipe问题**
   - 安装Microsoft Visual C++ Redistributable
   - 考虑使用conda环境管理

2. **网络配置优化**
   - 配置正确的代理设置
   - 使用Docker容器化部署

3. **模型文件管理**
   - 创建models目录
   - 下载必要的预训练模型

4. **性能优化**
   - 考虑GPU版本PyTorch
   - 优化依赖包版本

## 📊 部署状态总结

| 组件 | 状态 | 版本 | 备注 |
|------|------|------|------|
| Python | ✅ 正常 | 3.11.0 | 虚拟环境中运行 |
| PyTorch | ✅ 正常 | 2.8.0+cpu | CPU版本 |
| OpenCV | ✅ 正常 | 4.8.1 | 图像处理正常 |
| Gradio | ⚠️ 部分问题 | 5.44.1 | 网络启动问题 |
| MediaPipe | ❌ 失败 | 0.10.21 | DLL加载失败 |
| NumPy | ✅ 正常 | 1.26.4 | 数值计算正常 |

## 🎯 结论

Python虚拟环境已成功创建并配置了大部分依赖包。核心功能（PyTorch、OpenCV、NumPy）运行正常，但MediaPipe和Gradio存在系统兼容性问题。建议优先解决MediaPipe的DLL问题，这是影响完整功能运行的主要障碍。

---

**创建时间：** 2024年
**更新时间：** 最后更新于虚拟环境配置完成时
**维护者：** 2D数字人项目团队