# 数字人唇形优化项目依赖安装说明

## 快速安装

### 方法一：使用自动安装脚本（推荐）

**Windows用户：**
```bash
# 运行批处理脚本
install_dependencies.bat
```

**所有平台用户：**
```bash
# 运行Python安装脚本
python install_dependencies.py
```

### 方法二：手动安装

```bash
# 1. 升级pip
python -m pip install --upgrade pip

# 2. 安装基础依赖
pip install -r requirements.txt

# 3. 安装额外依赖
pip install audiomentations>=0.30.0 dominate>=2.6.0 librosa>=0.9.0 thop>=0.1.1 psutil>=5.9.0 imageio>=2.25.0 beautifulsoup4>=4.11.0
```

## 依赖包详细说明

### 核心框架依赖

| 包名 | 版本 | 作用 | 重要性 |
|------|------|------|--------|
| **torch** | 2.8.0+cpu | PyTorch深度学习框架，模型训练和推理的核心 | 🔴 必需 |
| **torchvision** | 0.23.0+cpu | 计算机视觉工具包，提供预训练模型和变换 | 🔴 必需 |
| **torchaudio** | 2.8.0+cpu | 音频处理工具包，音频特征提取 | 🔴 必需 |
| **gradio** | 4.16.0 | Web界面框架，提供用户交互界面 | 🔴 必需 |
| **fastapi** | 0.104.1 | 高性能Web API框架 | 🟡 重要 |

### 计算机视觉依赖

| 包名 | 版本 | 作用 | 重要性 |
|------|------|------|--------|
| **opencv-python** | 4.8.1.78 | 计算机视觉库，图像处理和视频处理 | 🔴 必需 |
| **opencv-contrib-python** | 4.11.0.86 | OpenCV扩展模块 | 🟡 重要 |
| **mediapipe** | 0.10.7 | 人脸检测和关键点提取 | 🔴 必需 |
| **pillow** | 10.4.0 | 图像处理库 | 🔴 必需 |
| **imageio** | >=2.25.0 | 图像和视频IO操作 | 🟡 重要 |

### 音频处理依赖

| 包名 | 版本 | 作用 | 重要性 |
|------|------|------|--------|
| **librosa** | >=0.9.0 | 音频分析和特征提取 | 🔴 必需 |
| **sounddevice** | 0.5.2 | 音频设备访问和播放 | 🟡 重要 |
| **pydub** | 0.25.1 | 音频格式转换和处理 | 🟡 重要 |
| **audiomentations** | >=0.30.0 | 音频数据增强 | 🟢 可选 |
| **kaldi-native-fbank** | 1.21.4 | 音频特征提取（Fbank） | 🔴 必需 |

### 科学计算依赖

| 包名 | 版本 | 作用 | 重要性 |
|------|------|------|--------|
| **numpy** | 1.26.4 | 数值计算基础库 | 🔴 必需 |
| **scipy** | 1.16.1 | 科学计算库 | 🔴 必需 |
| **scikit-learn** | 1.7.1 | 机器学习算法库 | 🟡 重要 |
| **pandas** | 2.3.2 | 数据处理和分析 | 🟡 重要 |
| **matplotlib** | 3.10.6 | 数据可视化 | 🟢 可选 |

### 工具和辅助依赖

| 包名 | 版本 | 作用 | 重要性 |
|------|------|------|--------|
| **tqdm** | 4.67.1 | 进度条显示 | 🟡 重要 |
| **thop** | >=0.1.1 | 模型复杂度分析 | 🟢 可选 |
| **psutil** | >=5.9.0 | 系统资源监控 | 🟢 可选 |
| **dominate** | >=2.6.0 | HTML文档生成 | 🟢 可选 |
| **beautifulsoup4** | >=4.11.0 | HTML解析 | 🟢 可选 |

### 3D图形和渲染依赖

| 包名 | 版本 | 作用 | 重要性 |
|------|------|------|--------|
| **PyOpenGL** | 3.1.10 | OpenGL绑定，3D渲染 | 🟡 重要 |
| **glfw** | 2.9.0 | 窗口管理和输入处理 | 🟡 重要 |
| **pyglm** | 2.8.2 | 3D数学库 | 🟡 重要 |

## 安装注意事项

### 系统要求

- **Python版本**: 3.9-3.11（推荐3.10）
- **操作系统**: Windows 10/11, Ubuntu 18.04+, macOS 10.15+
- **内存**: 至少8GB RAM
- **存储**: 至少5GB可用空间
- **GPU**: 可选，支持CUDA 11.8+

### Windows特殊要求

1. **Visual C++ Redistributable**
   ```
   下载并安装: Microsoft Visual C++ 2019-2022 Redistributable
   项目中包含: vc_redist_x64.exe
   ```

2. **音频驱动**
   - 确保系统音频驱动正常工作
   - 某些功能需要麦克风和扬声器权限

### 常见安装问题

#### 1. MediaPipe安装失败
```bash
# 解决方案1: 降级Python版本
python --version  # 确保是3.9-3.11

# 解决方案2: 使用预编译版本
pip install mediapipe --no-deps
pip install opencv-python numpy protobuf
```

#### 2. PyTorch安装问题
```bash
# CPU版本（默认）
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu

# GPU版本（如果有NVIDIA GPU）
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
```

#### 3. 音频库安装问题
```bash
# Linux用户可能需要安装系统依赖
sudo apt-get install libsndfile1 ffmpeg

# macOS用户
brew install ffmpeg
```

#### 4. OpenGL相关问题
```bash
# 如果遇到OpenGL错误，尝试安装Mesa
# Linux:
sudo apt-get install mesa-utils

# Windows: 更新显卡驱动
```

### 验证安装

运行以下命令验证关键组件：

```python
# 验证脚本
python -c "
import torch; print(f'PyTorch: {torch.__version__}')
import cv2; print(f'OpenCV: {cv2.__version__}')
import mediapipe; print(f'MediaPipe: {mediapipe.__version__}')
import gradio; print(f'Gradio: {gradio.__version__}')
import librosa; print(f'Librosa: {librosa.__version__}')
print('✅ 所有核心依赖安装成功！')
"
```

### 性能优化建议

1. **GPU加速**（可选）
   ```bash
   # 如果有NVIDIA GPU，安装CUDA版本
   pip uninstall torch torchvision torchaudio
   pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
   ```

2. **内存优化**
   - 关闭不必要的应用程序
   - 增加虚拟内存（Windows）
   - 使用SSD存储提升IO性能

3. **网络优化**
   ```bash
   # 使用国内镜像源加速安装
   pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/
   ```

## 故障排除

### 如果安装失败

1. **清理环境**
   ```bash
   pip cache purge
   pip install --upgrade pip setuptools wheel
   ```

2. **逐个安装**
   ```bash
   # 按重要性逐个安装，定位问题包
   pip install torch torchvision torchaudio
   pip install opencv-python
   pip install mediapipe
   pip install gradio
   # ... 继续其他包
   ```

3. **使用虚拟环境**
   ```bash
   python -m venv venv
   # Windows
   venv\Scripts\activate
   # Linux/macOS
   source venv/bin/activate
   
   pip install -r requirements.txt
   ```

### 获取帮助

如果遇到无法解决的问题：

1. 检查Python版本和系统兼容性
2. 查看详细错误信息
3. 搜索相关错误解决方案
4. 考虑使用Docker容器化部署

---

**重要提示**: 首次安装可能需要较长时间（10-30分钟），请耐心等待。建议在稳定的网络环境下进行安装。